"use client"

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"

interface DistributionData {
  [key: string]: {
    total: number
    critical: number
    high: number
    medium: number
    low: number
  }
}

interface VulnerabilityHeatmapProps {
  distribution: DistributionData
}

export function VulnerabilityHeatmap({ distribution }: VulnerabilityHeatmapProps) {
  const categories = Object.keys(distribution)
  const severities = ["critical", "high", "medium", "low"]

  const getHeatColor = (value: number, max: number) => {
    const intensity = value / max
    if (intensity > 0.7) return "bg-red-500"
    if (intensity > 0.5) return "bg-orange-500"
    if (intensity > 0.3) return "bg-yellow-500"
    if (intensity > 0) return "bg-green-500"
    return "bg-slate-800"
  }

  const maxValue = Math.max(...Object.values(distribution).flatMap((d) => [d.critical, d.high, d.medium, d.low]))

  return (
    <Card className="border-slate-700 bg-[#1a1a1a]">
      <CardHeader>
        <CardTitle className="text-lg text-cyan-400">Vulnerability Heatmap</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="overflow-x-auto">
          <div className="inline-block min-w-full">
            <div className="grid gap-2" style={{ gridTemplateColumns: `120px repeat(${severities.length}, 1fr)` }}>
              <div></div>
              {severities.map((severity) => (
                <div key={severity} className="text-center text-xs font-semibold uppercase text-gray-400">
                  {severity}
                </div>
              ))}
              {categories.map((category) => (
                <>
                  <div key={`${category}-label`} className="flex items-center text-sm font-medium text-gray-300">
                    {category}
                  </div>
                  {severities.map((severity) => {
                    const value = distribution[category][severity as keyof (typeof distribution)[typeof category]]
                    return (
                      <div
                        key={`${category}-${severity}`}
                        className={`flex h-16 items-center justify-center rounded ${getHeatColor(value, maxValue)} transition-all hover:scale-105 hover:shadow-lg`}
                      >
                        <span className="text-lg font-bold text-white">{value}</span>
                      </div>
                    )
                  })}
                </>
              ))}
            </div>
          </div>
        </div>
        <div className="mt-4 flex items-center justify-center gap-4 text-xs text-gray-400">
          <div className="flex items-center gap-2">
            <div className="h-4 w-4 rounded bg-slate-800"></div>
            <span>None</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="h-4 w-4 rounded bg-green-500"></div>
            <span>Low</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="h-4 w-4 rounded bg-yellow-500"></div>
            <span>Medium</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="h-4 w-4 rounded bg-orange-500"></div>
            <span>High</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="h-4 w-4 rounded bg-red-500"></div>
            <span>Critical</span>
          </div>
        </div>
      </CardContent>
    </Card>
  )
}
